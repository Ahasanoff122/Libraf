<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LİBRAFF</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      #popLayer {
        display: none;
      }
    
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none; 
  }

  .scrollbar-hide {
    -ms-overflow-style: none;  
    scrollbar-width: none;     
  }


    </style>
  </head>

  <body>
    <header class="bg-white p-2 border-b border-gray-200 shadow-sm">
      <div id="popLayer" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div
          class="absolute top-1/2 left-1/2 w-[80vw] h-[80vh] -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-lg flex"
        >
          <div id="popupMenu" class="flex w-full h-full "></div>
        </div>
      </div>

      <div class="container mx-auto flex justify-between items-center h-16">
        <a
          rel="noopener noreferrer"
          href="#"
          aria-label="Back to homepage"
          class="flex items-center p-2"
        >
          <img
            class="w-[120px]"
            src="https://bestsoft.az/uploaded/client/pic_365.png"
            alt="LIBRAFF Logo"
          />
        </a>
        <div class="flex items-center space-x-4">
          <div class="header-catalog-button hover:cursor-pointer bg-[#dc2626] text-[#ffffff] p-1 rounded-md" onclick="handlePopUp(true)">
    Kataloq
</div>
<div id="catalog-sidebar-popup" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
w-[900px] h-[600px] overflow-y-auto bg-white border border-gray-300 rounded-lg shadow-lg z-50 p-4">
    <!-- JS render edəcək -->
</div>


          <div class="relative hidden lg:block w-[400px]">
          <form autocomplete="off">
            <input
              type="text"
              id="searchInput"
              placeholder="Növbəti kitabınızı axtarın"
              autocomplete="off"
              class="w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-red-600"
            />
</form>
            <svg
              class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </div>
          <div class="flex items-center space-x-2 text-gray-600 hidden lg:flex">
            <span class="cursor-pointer">AZ</span>
            <svg
              class="w-4 h-4"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
          </div>
          <div class="flex items-center space-x-2 text-gray-600 hidden lg:flex">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A7.965 7.965 0 0112 15c2.275 0 4.408.877 6.012 2.368M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>

            <!-- <div id="authButtons">
  <button onclick="openModal('login')" class="bg-red-600 text-white px-4 py-1 rounded">Login</button>
  <button onclick="openModal('register')" class="bg-blue-600 text-white px-4 py-1 rounded">Register</button>
</div> -->


            <!-- <button onclick="addToCart(1)" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Səbətə əlavə et</button> -->

            <!-- <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg> -->
          </div>
          <div class="flex items-center space-x-4 text-gray-600">
            <div class="relative">
              <svg
                id="like-icon"
                class="w-5 h-5 cursor-pointer"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                ></path>
              </svg>
              <span
  id="like-count"
  class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 text-xs flex items-center justify-center pointer-events-none"
>0</span>

            </div>
            <div class="relative">
              <svg
                id="cart-icon"
                class="w-5 h-5 cursor-pointer"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.183 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                ></path>
              </svg>
             <span
  id="cart-count"
  class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 text-xs flex items-center justify-center pointer-events-none"
>0</span>

              
            </div>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-200 mt-2 py-2 hidden lg:block">
        <div
          class="container mx-auto flex justify-start space-x-6 text-gray-700 text-sm"
        >
          <a
            href="#"
            class="font-semibold text-gray-900 border-b-2 border-red-600 pb-2"
            >Bestseller - İyul</a
          >
          <a href="" class="hover:text-red-600 transition-colors duration-200"
            >Endirimlər</a
          >
          <a
            href="/pages/authors.html"
            class="hover:text-red-600 transition-colors duration-200"
            >Müəlliflər</a
          >
          <a href="/pages/catalog.html?category=Klassiklər" class="hover:text-red-600 transition-colors duration-200"
            >Klassiklər</a
          >
        </div>
      </div>
    </header>
    <section
      id="slider"
      class="relative overflow-hidden w-full h-[200px] sm:h-[300px] md:h-[400px] bg-gray-100 mt-4 rounded-2xl shadow-lg"
    >
      <div
        id="slider-container"
        class="flex transition-transform duration-700 ease-in-out h-full"
      ></div>
      <button
        id="prev-btn"
        class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-white/70 hover:bg-white text-gray-800 rounded-full p-3 shadow-lg backdrop-blur-md focus:outline-none z-10 transition-all duration-300"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>
      <button
        id="next-btn"
        class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-white/70 hover:bg-white text-gray-800 rounded-full p-3 shadow-lg backdrop-blur-md focus:outline-none z-10 transition-all duration-300"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>
      <div
        id="slider-dots"
        class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10"
      ></div>
    </section>
    <div id="header"></div>
    <main>
      <div class="max-w-[1250px] mx-auto">
        <div
          id="books"
          class="grid grid-cols-4 gap-4"
          style="padding-top: 20px; padding-bottom: 20px"
        ></div>
      </div>

      <div id="crudPopup" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div
          class="absolute top-1/2 left-1/2 w-full max-w-lg p-6 bg-white rounded-lg shadow-xl transform -translate-x-1/2 -translate-y-1/2"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">Kitab əlavə et</h3>
            <button
              onclick="toggleCrudPopup(false)"
              class="text-gray-500 hover:text-gray-700 text-2xl"
            >
              ✖
            </button>
          </div>
          <form id="crudForm" class="space-y-4">
            <div>
              <label
                for="bookName"
                class="block text-sm font-medium text-gray-700"
                >Ad</label
              >
              <input
                type="text"
                id="bookName"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
                required
              />
            </div>
            <div>
              <label
                for="bookAuthor"
                class="block text-sm font-medium text-gray-700"
                >Müəllif</label
              >
              <input
                type="text"
                id="bookAuthor"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
              />
            </div>
            <div>
              <label
                for="bookImage"
                class="block text-sm font-medium text-gray-700"
                >Şəkil URL</label
              >
              <input
                type="url"
                id="bookImage"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
              />
            </div>
            <div>
              <label
                for="bookPrice"
                class="block text-sm font-medium text-gray-700"
                >Qiymət</label
              >
              <input
                type="number"
                step="0.01"
                id="bookPrice"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
              />
            </div>
            <div>
              <label
                for="bookSale"
                class="block text-sm font-medium text-gray-700"
                >Endirim (%)</label
              >
              <input
                type="number"
                step="1"
                id="bookSale"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
              />
            </div>
            <div>
              <label
                for="bookStock"
                class="block text-sm font-medium text-gray-700"
                >Stok</label
              >
              <input
                type="number"
                step="1"
                id="bookStock"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2"
              />
            </div>

            <div id="extraFields" class="space-y-2"></div>
            <button
              type="button"
              id="addField"
              class="w-full text-blue-500 py-2 border-dashed border-2 border-blue-200 rounded-md"
            >
              Əlavə sahə əlavə et
            </button>

            <button
              type="button"
              id="saveBook"
              class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors"
            >
              Kitabı əlavə et
            </button>
          </form>
        </div>
      </div>
    </main>

    <script type="module" src="./js/headerCatalog.js"></script>
    <script type="module" src="./js/authors.js"></script>
    <script type="module" src="./js/data.js"></script>
    <script src="./js/showpopup.js"></script>
    <script type="module" src="./js/search.js"></script>
    <script type="module" src="./js/kategory.js"></script>
    <script type="module" src="./js/slider.js"></script>
    <script type="module" src="./js/script.js"></script>
    <script src="./middleware/headerProvider.js"></script>
    <script src="./middle/middleware.js"></script>
    <script type="module" src="./js/service.js"></script>
    <script type="module" src="./js/index.js"></script>
   
   
    <!-- Firebase App (core) SDK -->
    <!-- <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js"></script> -->
    <!-- Firebase Auth SDK -->
    <!-- <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js"></script> -->

    <!-- Modal -->
    <!-- Auth Modal -->
    <!-- <div
      id="authModal"
      class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-xl shadow-lg w-[90%] max-w-md p-6 relative">
        <button
          onclick="closeModal()"
          class="absolute top-3 right-3 text-gray-500 text-xl"
        >
          ✖
        </button>

       
      </div>
    </div> -->
    <!-- Cart Modal -->
    <div
      id="cart-modal"
      class=" fixed top-0 right-0 w-80 h-full bg-white shadow-2xl transform translate-x-full  transition-transform overflow-y-auto scrollbar-hide z-50 rounded-l-lg border-l border-gray-200 "
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50 sticky top-0 z-10"
      >
        <h2 class="font-bold text-lg text-gray-800">Səbət</h2>
        <button
          id="close-cart"
          class="text-gray-500 text-2xl hover:text-gray-700 transition"
        >
          &times;
        </button>
      </div>
      <ul id="cart-list" class="p-4 space-y-4">
        <!-- Kitablar burda list olacaq -->
      </ul>
      <!-- <div class="p-4 border-t border-gray-200 bg-gray-50 sticky bottom-0">
        <p class="text-sm text-gray-600">
          Ümumi kitab sayı:
          <span id="cart-count-bottom" class="font-bold">0</span>
        </p>
      </div> -->
    </div>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity z-50"
    >
      Kitab səbətə əlavə olundu!
    </div>
    <div
      id="like-modal"
      class="fixed top-0 right-0 w-80 h-full bg-white shadow-2xl transform translate-x-full transition-transform overflow-y-auto scrollbar-hide z-50 rounded-l-lg border-l border-gray-200"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50 sticky top-0 z-10"
      >
        <h2 class="font-bold text-lg text-gray-800">Liked</h2>
        <button
          id="close-like"
          class="text-gray-500 text-2xl hover:text-gray-700 transition"
        >
          &times;
        </button>
      </div>
      <ul id="like-list" class="p-4 space-y-4">
        <!-- Kitablar burda list olacaq -->
      </ul>
    </div>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity z-50"
    >
      Kitab bəyənilənlərə əlavə olundu!
    </div>
    <!-- Reset Password Modal -->
    <div
      id="resetModal"
      class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-xl shadow-lg w-[90%] max-w-md p-6 relative">
        <button
          onclick="closeResetModal()"
          class="absolute top-3 right-3 text-gray-500 text-xl"
        >
          ✖
        </button>
        <h2 class="text-xl font-bold mb-4">Şifrəni bərpa et</h2>
        <input
          type="text"
          id="resetEmail"
          placeholder="Emailinizi daxil edin"
          class="w-full border p-2 rounded mb-4"
        />
        <button
          onclick="resetPassword()"
          class="w-full bg-green-600 text-white py-2 rounded"
        >
          Göndər
        </button>
        <p id="resetMsg" class="text-sm text-red-500 mt-2"></p>
      </div>
    </div>

    <!-- <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";

      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
        sendEmailVerification,
        sendPasswordResetEmail,
        browserLocalPersistence,
        setPersistence,
      } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyD6MLOOhj1AbAP4mSW9800bLKr7dKyB5QU",
        authDomain: "libraff-2d9de.firebaseapp.com",
        projectId: "libraff-2d9de",
        storageBucket: "libraff-2d9de.firebasestorage.app",
        messagingSenderId: "935006086000",
        appId: "1:935006086000:web:518181af1ca12d680ea5b5",
        measurementId: "G-1RGYRR5776",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      setPersistence(auth, browserLocalPersistence)
        .then(() => console.log("Sessiya localStorage-da saxlanacaq."))
        .catch((error) => console.error(error.message));
        

      // Modal funksiyaları
        function openModal(type) {
          document.getElementById("authModal").classList.remove("hidden");
          document.getElementById("loginForm").classList.add("hidden");
          document.getElementById("registerForm").classList.add("hidden");
          if (type === "login")
            document.getElementById("loginForm").classList.remove("hidden");
          else document.getElementById("registerForm").classList.remove("hidden");
        }
        function closeModal() {
          document.getElementById("authModal").classList.add("hidden");
        }

        function openResetModal() {
          document.getElementById("resetModal").classList.remove("hidden");
          closeModal();
        }
        function closeResetModal() {
          document.getElementById("resetModal").classList.add("hidden");
        }
  // Cart funksiyaları
  // 1️⃣ Səbətə əlavə et funksiyası
  document.addEventListener("DOMContentLoaded", () => {
      // ✅ CART MODAL
      const cartIcon = document.getElementById("cart-icon");
      const closeCartBtn = document.getElementById("close-cart");
      const cartModal = document.getElementById("cart-modal");

      if (cartIcon && cartModal) {
          cartIcon.addEventListener("click", () => {
              renderCartModal();
              cartModal.classList.remove("translate-x-full");
          });
      }

    if (closeCartBtn && cartModal) {
        closeCartBtn.addEventListener("click", () => {
            cartModal.classList.add("translate-x-full");
        });
    }

    updateCartCount();

    // ✅ LIKE MODAL
    const likeIcon = document.getElementById("like-icon");
    const closeLikeBtn = document.getElementById("close-like");
    const likeModal = document.getElementById("like-modal");

    if (likeIcon && likeModal) {
        likeIcon.addEventListener("click", () => {
            renderLikeModal();
            likeModal.classList.remove("translate-x-full");
        });
    }

    if (closeLikeBtn && likeModal) {
        closeLikeBtn.addEventListener("click", () => {
            likeModal.classList.add("translate-x-full");
        });
    }

    updateLikeCount();
});

function addToLike(book) {
    let liked = JSON.parse(localStorage.getItem("liked")) || [];
    const urlsInLiked = liked.map(item => String(item.product_url));

    if (!urlsInLiked.includes(String(book.product_url))) {
        liked.push(book);
        localStorage.setItem("liked", JSON.stringify(liked));
        updateLikeCount();
        renderLikeModal();
        showToast(`${book.name} bəyənilənlərə əlavə olundu!`, "success");
    } else {
        showToast("Bu kitab artıq bəyənilənlərdədir!", "error");
    }
}

// Kitab əlavə etmək
// CART FUNKSİYALARI
function addToCart(book) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const urlsInCart = cart.map(item => item.product_url.toString());

    if (!urlsInCart.includes(book.product_url.toString())) {
        cart.push(book);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCartModal();
        updateCartCount(); // Bu sətri renderCartModal-dan sonra əlavə et
        showToast(`${book.name} səbətə əlavə olundu!`, "success");
    } else {
        showToast("Bu kitab artıq səbətdədir!", "error");
    }
}

function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    document.getElementById("cart-count").textContent = cart.length;
}

function renderCartModal() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const list = document.getElementById("cart-list");
    list.innerHTML = "";

    cart.forEach((book, index) => {
        const li = document.createElement("li");
        li.className = "border p-2 rounded flex flex-col space-y-2";
        li.innerHTML = `
             <div class="flex space-x-3">
                <img src="${book.image}" alt="${book.name}" class="w-20 h-28 object-cover rounded-lg">
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h2 class="font-bold text-gray-800 text-sm">${book.name}</h2>
                        <p class="text-gray-500 text-xs">${book.author || ''}</p>
                    </div>
                    <div class="price">
  <span class="text-gray-400 line-through mr-2">${book.list_price}</span>
  <span class="text-red-500 font-bold">${book.price}₼</span>
</div>
                    <div class="mt-2 flex items-center justify-between">
                        <a href="pages/viewdetail.html?product=${book.product_url}" target="_blank" class="text-blue-500 text-xs hover:underline">View Details</a>
                        <button class="remove-btn text-red-500 text-xs px-2 py-1 rounded border border-red-500 hover:bg-red-500 hover:text-white transition">Sil</button>
                    </div>
                </div>
            </div>
        `;
        list.appendChild(li);

        li.querySelector(".remove-btn").addEventListener("click", () => {
            removeFromCart(index);
        });
    });

    // const countBottom = document.getElementById("cart-count-bottom");
    // if (countBottom) countBottom.textContent = cart.length;
}

function removeFromCart(index) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    renderCartModal();
}


// LIKE FUNKSİYALARI
function likeBook(book) {
    let liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    const urlsInLiked = liked.map(item => String(item.product_url));

    if (!urlsInLiked.includes(String(book.product_url))) {
        liked.push(book);
        localStorage.setItem("likedBooks", JSON.stringify(liked));
        updateLikeCount();
        renderLikeModal();
        showToast(`${book.name} bəyənildi!`, "success");
    } else {
        showToast("Bu kitab artıq bəyənilib!", "error");
    }
}

function updateLikeCount() {
    const liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    document.getElementById("like-count").textContent = liked.length;
}

function renderLikeModal() {
    const liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    const list = document.getElementById("like-list");
    list.innerHTML = "";

    liked.forEach((book, index) => {
        const li = document.createElement("li");
        li.className = "border p-2 rounded flex flex-col space-y-2";
        li.innerHTML = `
             <div class="flex space-x-3">
                <img src="${book.image}" alt="${book.name}" class="w-20 h-28 object-cover rounded-lg">
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h2 class="font-bold text-gray-800 text-sm">${book.name}</h2>
                        <p class="text-gray-500 text-xs">${book.author || ''}</p>
                        <a href="pages/viewdetail.html?product=${book.product_url}" target="_blank" class="text-blue-500 text-xs hover:underline">View Details</a>
                    </div>
                    <div class="price">
  <span class="text-gray-400 line-through mr-2">${book.list_price}</span>
  <span class="text-red-500 font-bold">${book.price}₼</span>
</div>
                    <div class="mt-2 flex items-center justify-between">
                         <button class="add-to-cart-btn bg-green-500 text-white px-3 py-1 rounded text-xs">Səbətə əlavə et</button>
                        <button class="remove-btn text-red-500 text-xs px-2 py-1 rounded border border-red-500 hover:bg-red-500 hover:text-white transition">Sil</button>
                    </div>
                </div>
            </div>
        `;
        list.appendChild(li);
        li.querySelector(".add-to-cart-btn").addEventListener("click", () => {
            addToCart(book);
        });

        li.querySelector(".remove-btn").addEventListener("click", () => {
            removeFromLiked(index);
        });
    });

    const countBottom = document.getElementById("like-count-bottom");
    if (countBottom) countBottom.textContent = liked.length;
}

function removeFromLiked(index) {
    let liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    liked.splice(index, 1);
    localStorage.setItem("likedBooks", JSON.stringify(liked));
    updateLikeCount();
    renderLikeModal();
}


// Modern Toast
function showToast(message, type = "success") {
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg text-white z-50 ${
        type === "success" ? "bg-green-500" : "bg-red-500"
    }`;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.remove();
    }, 2000);
}




// 4️⃣ SVG kliklərini div-ə bağla (SVG overlay problemi üçün)
document.getElementById("cart-wrapper").addEventListener("click", () => {
    renderCartModal();
    document.getElementById("cart-modal").classList.remove("translate-x-full");
});

document.getElementById("").addEventListener("click", () => {
    document.getElementById("cart-modal").classList.add("translate-x-full");
});

// 5️⃣ Sayt açılan kimi cart sayı göstərilsin
updateCartCount(); 
      // Register
      function registerUser() {
        const email = document.getElementById("regEmail").value.trim();
        const password = document.getElementById("regPassword").value.trim();
        const regMsg = document.getElementById("regMsg");
        regMsg.textContent = "";

        if (!email || !password) {
          regMsg.textContent = "Bütün sahələr doldurulmalıdır!";
          return;
        }

        createUserWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    sendEmailVerification(userCredential.user)
      .then(() => showToast("Hesab yaradıldı. Emailinizi yoxlayın!", "success"))
      .catch((err) => showToast(err.message, "error"));
  })
  .catch((error) => {
    switch (error.code) {
      case "auth/invalid-email":
        regMsg.textContent = "Email düzgün formatda deyil!";
        showToast("Email düzgün formatda deyil!", "error");
        break;
      case "auth/email-already-in-use":
        regMsg.textContent = "Bu email artıq istifadə olunur!";
        showToast("Bu email artıq istifadə olunur!", "error");
        break;
      case "auth/weak-password":
        regMsg.textContent = "Şifrə çox zəifdir!";
        showToast("Şifrə çox zəifdir!", "error");
        break;
      default:
        regMsg.textContent = error.message;
        showToast(error.message, "error");
    }
  });
      }

      // Login
      function loginUser() {
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value.trim();
        const loginMsg = document.getElementById("loginMsg");
        loginMsg.textContent = "";

        if (!email || !password) {
          loginMsg.textContent = "Bütün sahələr doldurulmalıdır!";
          return;
        }

        signInWithEmailAndPassword(auth, email, password)
          .then(() => {
            loginMsg.textContent = "Uğurla daxil olundu!";
            loginMsg.classList.remove("text-red-500");
            loginMsg.classList.add("text-green-500");
            closeModal();
          })
          .catch((error) => {
            switch (error.code) {
              case "auth/invalid-email":
                loginMsg.textContent = "Email düzgün formatda deyil!";
                break;
              case "auth/user-not-found":
                loginMsg.textContent = "İstifadəçi tapılmadı!";
                break;
              case "auth/wrong-password":
                loginMsg.textContent = "Şifrə yanlışdır!";
                break;
              default:
                loginMsg.textContent = error.message;
            }
            loginMsg.classList.add("text-red-500");
          });
      }

      // Logout
      function logoutUser() {
        signOut(auth)
          .then(() => {
            showToast("Uğurla çıxış etdiniz!");
            updateAuthUI(null); // UI-ni yenilə
          })
          .catch((error) => {
            showToast("Xəta baş verdi: " + error.message, "red");
          });
      }

      // Toast göstərmək üçün funksiyanı əlavə et
      function showToast(message, bgColor = "green") {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.remove("opacity-0", "pointer-events-none");
        toast.classList.add(`bg-${bgColor}-500`);
        setTimeout(() => {
          toast.classList.add("opacity-0", "pointer-events-none");
        }, 1500); // 3 saniyə görünür
      }

      // Update UI
      const authButtons = document.getElementById('authButtons');
        function updateAuthUI(user) {
            authButtons.innerHTML = '';
            if (user) {
                authButtons.innerHTML = `
            <span class="text-gray-700 mr-2">${user.email}</span>
            <button onclick="logoutUser()" class="bg-gray-700 text-white px-4 py-1 rounded">Logout</button>
        `;
            } else {
                authButtons.innerHTML = `
            <button onclick="openModal('login')" class="bg-red-600 text-white px-4 py-1 rounded">Login</button>
            <button onclick="openModal('register')" class="bg-blue-600 text-white px-4 py-1 rounded">Register</button>
        `;
            }
        }
      function handlePopUp(show) {
        const popLayer = document.getElementById("popLayer");
        if (show) {
          popLayer.classList.remove("hidden");
        } else {
          popLayer.classList.add("hidden");
        }
      }

      function toggleCrudPopup(show) {
        const crudPopup = document.getElementById("crudPopup");
        if (show) {
          crudPopup.classList.remove("hidden");
        } else {
          crudPopup.classList.add("hidden");
        }
      }

      // Firebase auth state listener
     onAuthStateChanged(auth, (user) => updateAuthUI(user));

// CART MODAL
document.addEventListener("DOMContentLoaded", () => {
    const cartIcon = document.getElementById("cart-icon");
    const closeCartBtn = document.getElementById("close-cart");
    const cartModal = document.getElementById("cart-modal");

    // Aç
    if (cartIcon && cartModal) {
        cartIcon.addEventListener("click", () => {
            renderCartModal();
            cartModal.classList.remove("translate-x-full");
        });
    }

    // Bağla
    if (closeCartBtn && cartModal) {
        closeCartBtn.addEventListener("click", () => {
            cartModal.classList.add("translate-x-full");
        });
    }

    updateCartCount();
});

// LIKE MODAL
document.addEventListener("DOMContentLoaded", () => {
    const likeIcon = document.getElementById("like-icon");
    const closeLikeBtn = document.getElementById("close-like"); // ❗ burada ID ayrıca olmalıdır
    const likeModal = document.getElementById("like-modal");

    // Aç
    if (likeIcon && likeModal) {
        likeIcon.addEventListener("click", () => {
            renderLikeModal(); // ayrıca render funksiyan yoxdursa, renderCartModal() da qoya bilərsən
            likeModal.classList.remove("translate-x-full");
        });
    }

    // Bağla
    if (closeLikeBtn && likeModal) {
        closeLikeBtn.addEventListener("click", () => {
            likeModal.classList.add("translate-x-full");
        });
    }

    updateLikeCount();
});



      function resetPassword() {
        const email = document.getElementById("resetEmail").value.trim();
        if (!email) {
          alert("Email daxil edin!");
          return;
        }

        sendPasswordResetEmail(auth, email)
          .then(() => alert("Reset link emailinizə göndərildi!"))
          .catch((err) => alert(err.message));
      }


      window.resetPassword = resetPassword;

      // Globally
      window.openModal = openModal;
      window.closeModal = closeModal;
      window.loginUser = loginUser;
      window.registerUser = registerUser;
      window.logoutUser = logoutUser;
      window.openResetModal = openResetModal;
      window.closeResetModal = closeResetModal;
      window.resetPassword = resetPassword;
    </script> -->

    <div
      id="toast"
      class="fixed top-5 right-5 bg-green-500 text-white px-4 py-2 rounded shadow-lg opacity-0 pointer-events-none transition-all duration-300 z-50"
    >
      Uğurla çıxış etdiniz!
    </div>
  </body>
  <footer class="bg-gray-50 py-10 px-4 md:px-8 border-t border-gray-200">
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="font-bold mb-4 text-lg text-gray-800">Hesabım</h3>
        <ul class="space-y-2 text-gray-600">
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Daxil ol</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Qeydiyyatdan keç</a
            >
          </li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold mb-4 text-lg text-gray-800">Şirkət</h3>
        <ul class="space-y-2 text-gray-600">
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Haqqımızda</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors">Əlaqə</a>
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Vakansiyalar</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Sayt Xəritəsi</a
            >
          </li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold mb-4 text-lg text-gray-800">Müştəri Xidməti</h3>
        <ul class="space-y-2 text-gray-600">
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Dəyişdirilmə və qaytarılma</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Ödəniş və çatdırılma</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Sifarişiniz haqqında</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-blue-600 transition-colors"
              >Seçilmişlər</a
            >
          </li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold mb-4 text-lg text-gray-800">Əlaqə</h3>
        <div class="space-y-2 text-gray-600">
          <p>Bakı, Badamdar qəs., Mikayıl Müşfiq küç., 1c</p>
          <p>(Badamdar Estates)</p>
          <p>+994-50-290-44-96</p>
          <p>B.e - B. 9:00 - 18:00</p>
          <p>
            <a href="mailto:online@ultraff.az" class="hover:underline"
              >online@ultraff.az</a
            >
          </p>
          <p><a href="#" class="hover:underline">Xəritədə bax</a></p>
        </div>
      </div>
    </div>
  </footer>
</html>
