<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Kitab Detallarƒ±</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
     .scrollbar-hide::-webkit-scrollbar {
    display: none; 
  }

  .scrollbar-hide {
    -ms-overflow-style: none;  
    scrollbar-width: none;     
  }
  </style>
</head>
<header class="bg-white p-2 border-b border-gray-200 shadow-sm">
      <div id="popLayer" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div
          class="absolute top-1/2 left-1/2 w-[80vw] h-[80vh] -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-lg flex"
        >
          <div id="popupMenu" class="flex w-full h-full"></div>
        </div>
      </div>

      <div class="container mx-auto flex justify-between items-center h-16">
        <a
          rel="noopener noreferrer"
          href="#"
          aria-label="Back to homepage"
          class="flex items-center p-2"
        >
          <img
            class="w-[120px]"
            src="https://bestsoft.az/uploaded/client/pic_365.png"
            alt="LIBRAFF Logo"
          />
        </a>
        <div class="flex items-center space-x-4">
          <div class="header-catalog-button hover:cursor-pointer bg-[#dc2626] text-[#ffffff] p-1 rounded-md" onclick="handlePopUp(true)">
    Kataloq
</div>
<div id="catalog-sidebar-popup" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
w-96 max-h-[600px] overflow-y-auto bg-white border border-gray-300 rounded-lg shadow-lg z-50 p-4">
    <!-- JS render ed…ôc…ôk -->
</div>


          <div class="relative hidden lg:block w-[400px]">
          <form autocomplete="off">
            <input
              type="text"
              id="searchInput"
              placeholder="N√∂vb…ôti kitabƒ±nƒ±zƒ± axtarƒ±n"
              autocomplete="off"
              class="w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-red-600"
            />
</form>
            <svg
              class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </div>
          <div class="flex items-center space-x-2 text-gray-600 hidden lg:flex">
            <span class="cursor-pointer">AZ</span>
            <svg
              class="w-4 h-4"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
          </div>
          <div class="flex items-center space-x-2 text-gray-600 hidden lg:flex">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A7.965 7.965 0 0112 15c2.275 0 4.408.877 6.012 2.368M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>

            <!-- <div id="authButtons">
  <button onclick="openModal('login')" class="bg-red-600 text-white px-4 py-1 rounded">Login</button>
  <button onclick="openModal('register')" class="bg-blue-600 text-white px-4 py-1 rounded">Register</button>
</div> -->


            <!-- <button onclick="addToCart(1)" class="bg-green-500 text-white px-3 py-1 rounded text-sm">S…ôb…ôt…ô …ôlav…ô et</button> -->

            <!-- <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg> -->
          </div>
          <div class="flex items-center space-x-4 text-gray-600">
            <div class="relative">
              <svg
                id="like-icon"
                class="w-5 h-5 cursor-pointer"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                ></path>
              </svg>
              <span
  id="like-count"
  class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 text-xs flex items-center justify-center pointer-events-none"
>0</span>

            </div>
            <div class="relative">
              <svg
                id="cart-icon"
                class="w-5 h-5 cursor-pointer"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.183 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                ></path>
              </svg>
             <span
  id="cart-count"
  class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 text-xs flex items-center justify-center pointer-events-none"
>0</span>

              
            </div>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-200 mt-2 py-2 hidden lg:block">
        <div
          class="container mx-auto flex justify-start space-x-6 text-gray-700 text-sm"
        >
          <a
            href="#"
            class="font-semibold text-gray-900 border-b-2 border-red-600 pb-2"
            >Bestseller - ƒ∞yul</a
          >
          <a href="" class="hover:text-red-600 transition-colors duration-200"
            >Endiriml…ôr</a
          >
          <a
            href="./authors.html"
            class="hover:text-red-600 transition-colors duration-200"
            >M√º…ôllifl…ôr</a
          >
          <a href="/src/pages/catalog.html?category=Klassikl…ôr" class="hover:text-red-600 transition-colors duration-200"
            >Klassikl…ôr</a
          >
        </div>
      </div>
    </header>
<body class="bg-gray-100">
  <div id="book-detail" class="max-w-4xl mx-auto p-6"></div>

  <h2 class="text-xl font-bold mt-10 mb-4 text-center">Ox≈üar kitablar</h2>
  <div id="similar-books" class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-5xl mx-auto"></div>
  <div
      id="cart-modal"
      class=" fixed top-0 right-0 w-80 h-full bg-white shadow-2xl transform translate-x-full  transition-transform overflow-y-auto scrollbar-hide z-50 rounded-l-lg border-l border-gray-200 "
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50 sticky top-0 z-10"
      >
        <h2 class="font-bold text-lg text-gray-800">S…ôb…ôt</h2>
        <button
          id="close-cart"
          class="text-gray-500 text-2xl hover:text-gray-700 transition"
        >
          &times;
        </button>
      </div>
      <ul id="cart-list" class="p-4 space-y-4">
        <!-- Kitablar burda list olacaq -->
      </ul>
      <!-- <div class="p-4 border-t border-gray-200 bg-gray-50 sticky bottom-0">
        <p class="text-sm text-gray-600">
          √úmumi kitab sayƒ±:
          <span id="cart-count-bottom" class="font-bold">0</span>
        </p>
      </div> -->
    </div>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity z-50"
    >
      Kitab s…ôb…ôt…ô …ôlav…ô olundu!
    </div>
    <div
      id="like-modal"
      class="fixed top-0 right-0 w-80 h-full bg-white shadow-2xl transform translate-x-full transition-transform overflow-y-auto scrollbar-hide z-50 rounded-l-lg border-l border-gray-200"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50 sticky top-0 z-10"
      >
        <h2 class="font-bold text-lg text-gray-800">Liked</h2>
        <button
          id="close-like"
          class="text-gray-500 text-2xl hover:text-gray-700 transition"
        >
          &times;
        </button>
      </div>
      <ul id="like-list" class="p-4 space-y-4">
        <!-- Kitablar burda list olacaq -->
      </ul>
    </div>

    <!-- Toast -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity z-50"
    >
      Kitab b…ôy…ônil…ônl…ôr…ô …ôlav…ô olundu!
    </div>
    <!-- Reset Password Modal -->
    <div
      id="resetModal"
      class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-xl shadow-lg w-[90%] max-w-md p-6 relative">
        <button
          onclick="closeResetModal()"
          class="absolute top-3 right-3 text-gray-500 text-xl"
        >
          ‚úñ
        </button>
        <h2 class="text-xl font-bold mb-4">≈ûifr…ôni b…ôrpa et</h2>
        <input
          type="text"
          id="resetEmail"
          placeholder="Emailinizi daxil edin"
          class="w-full border p-2 rounded mb-4"
        />
        <button
          onclick="resetPassword()"
          class="w-full bg-green-600 text-white py-2 rounded"
        >
          G√∂nd…ôr
        </button>
        <p id="resetMsg" class="text-sm text-red-500 mt-2"></p>
      </div>
    </div>

  <script type="module">
    // üìå data (√∂z data.js-d…ôn import ed…ô bil…ôrs…ôn, ya da burda yaz)
    import books from '../../db/db.js';
    

    // üìå URL-d…ôn product parametri g√∂t√ºr
    const params = new URLSearchParams(window.location.search);
    const productUrl = params.get("product");

    const bookDetail = document.getElementById("book-detail");
    const similarBooks = document.getElementById("similar-books");

    const book = books.find(b => b.product_url === productUrl);

    if (book) {
      // ∆èsas kitab detalƒ±
      bookDetail.innerHTML = `
 <div class="bg-white rounded shadow-xl p-10 flex gap-10 w-4xl mx-auto">
  <!-- ≈û…ôkil -->
  <img src="${book.image}" alt="${book.name}" class="w-[28rem] h-[36rem] object-cover rounded-lg">

  <!-- M…ôlumatlar -->
  <div class="flex flex-col justify-between flex-1">
    <div>
      <h1 class="text-6xl font-bold mb-5">${book.name}</h1>
      <p class="text-2xl text-gray-600 mb-4">${book.author}</p>
      <p class="text-xl text-gray-700 mb-8">${book.description || "T…ôsvir m…ôlumatƒ± yoxdur"}</p>
    </div>

    <!-- Qiym…ôt v…ô endirim -->
    <div class="mb-8">
      <!-- Endirimli qiym…ôt -->
      <p class="text-4xl font-bold text-red-600 mb-2">${book.price} ‚Çº</p>

      <!-- Endirimsiz qiym…ôt v…ô endirim faizi bir s…ôtird…ô -->
      <div class="flex items-center justify-start gap-4">
        <span class="line-through text-gray-400 text-xl">${book.list_price || ""} ‚Çº</span>
        <span class="bg-red-500 text-white text-base px-3 py-1 rounded">${book.discount_percent || ""}</span>
      </div>
    </div>

    <!-- S…ôb…ôt d√ºym…ôsi v…ô like -->
    <div class="flex items-center gap-6">
      <button class="bg-red-600 text-white px-5 py-3 rounded-xl hover:bg-red-700 transition text-xl">
        S…ôb…ôt…ô …ôlav…ô et
      </button>
      <button class="like-btn text-red-500 text-4xl" title="Like">‚ù§Ô∏è</button>
    </div>
  </div>
</div>



      `;

      // Ox≈üar kitablar (eyni janr)
   const relatedBooks = books.filter(b => b.genre === book.genre && b.product_url !== productUrl);
similarBooks.innerHTML = ""; // t…ômizl…ô

relatedBooks.forEach(b => {
    const div = document.createElement("div");
    div.className = "bg-white rounded shadow p-3 cursor-pointer hover:shadow-lg";
    
    // klikl…ô detail-…ô getm…ôk
    div.addEventListener("click", () => goToDetail(b.product_url));
    
    div.innerHTML = `
        <img src="${b.image}" alt="${b.name}" class="w-full h-40 object-cover rounded mb-2">
        <h3 class="text-sm font-bold">${b.name}</h3>
        <p class="text-xs text-gray-500">${b.author}</p>
        <div class="flex justify-between items-center pt-2">
            <button class="add-to-cart-btn bg-green-500 text-white px-3 py-1 rounded text-xs">S…ôb…ôt…ô …ôlav…ô et</button>
            <button class="like-btn text-red-500 text-xs">‚ù§Ô∏è</button>
        </div>
    `;
    
    // D√ºym…ôl…ôr √º√ß√ºn ayrƒ±ca event
    div.querySelector(".add-to-cart-btn").addEventListener("click", (e) => {
        e.stopPropagation(); // div klikini dayandƒ±r
        addToCart(b);
    });
    div.querySelector(".like-btn").addEventListener("click", (e) => {
        e.stopPropagation();
        likeBook(b);
    });

    similarBooks.appendChild(div);
});
    }


    // üìå Y√∂nl…ôndirm…ô funksiyasƒ±
    window.goToDetail = function(product_url) {
      window.location.href = `./viewdetail.html?product=${product_url}`;
    };
      function openModal(type) {
          document.getElementById("authModal").classList.remove("hidden");
          document.getElementById("loginForm").classList.add("hidden");
          document.getElementById("registerForm").classList.add("hidden");
          if (type === "login")
            document.getElementById("loginForm").classList.remove("hidden");
          else document.getElementById("registerForm").classList.remove("hidden");
        }
        function closeModal() {
          document.getElementById("authModal").classList.add("hidden");
        }

        function openResetModal() {
          document.getElementById("resetModal").classList.remove("hidden");
          closeModal();
        }
        function closeResetModal() {
          document.getElementById("resetModal").classList.add("hidden");
        }
  // Cart funksiyalarƒ±
  // 1Ô∏è‚É£ S…ôb…ôt…ô …ôlav…ô et funksiyasƒ±
  document.addEventListener("DOMContentLoaded", () => {
      // ‚úÖ CART MODAL
      const cartIcon = document.getElementById("cart-icon");
      const closeCartBtn = document.getElementById("close-cart");
      const cartModal = document.getElementById("cart-modal");

      if (cartIcon && cartModal) {
          cartIcon.addEventListener("click", () => {
              renderCartModal();
              cartModal.classList.remove("translate-x-full");
          });
      }

    if (closeCartBtn && cartModal) {
        closeCartBtn.addEventListener("click", () => {
            cartModal.classList.add("translate-x-full");
        });
    }

    updateCartCount();

    // ‚úÖ LIKE MODAL
    const likeIcon = document.getElementById("like-icon");
    const closeLikeBtn = document.getElementById("close-like");
    const likeModal = document.getElementById("like-modal");

    if (likeIcon && likeModal) {
        likeIcon.addEventListener("click", () => {
            renderLikeModal();
            likeModal.classList.remove("translate-x-full");
        });
    }

    if (closeLikeBtn && likeModal) {
        closeLikeBtn.addEventListener("click", () => {
            likeModal.classList.add("translate-x-full");
        });
    }

    updateLikeCount();
});

function addToLike(book) {
    let liked = JSON.parse(localStorage.getItem("liked")) || [];
    const urlsInLiked = liked.map(item => String(item.product_url));

    if (!urlsInLiked.includes(String(book.product_url))) {
        liked.push(book);
        localStorage.setItem("liked", JSON.stringify(liked));
        updateLikeCount();
        renderLikeModal();
        showToast(`${book.name} b…ôy…ônil…ônl…ôr…ô …ôlav…ô olundu!`, "success");
    } else {
        showToast("Bu kitab artƒ±q b…ôy…ônil…ônl…ôrd…ôdir!", "error");
    }
}

// Kitab …ôlav…ô etm…ôk
// CART FUNKSƒ∞YALARI
function addToCart(book) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const urlsInCart = cart.map(item => item.product_url.toString());

    if (!urlsInCart.includes(book.product_url.toString())) {
        cart.push(book);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCartModal();
        updateCartCount(); // Bu s…ôtri renderCartModal-dan sonra …ôlav…ô et
        showToast(`${book.name} s…ôb…ôt…ô …ôlav…ô olundu!`, "success");
    } else {
        showToast("Bu kitab artƒ±q s…ôb…ôtd…ôdir!", "error");
    }
}

function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    document.getElementById("cart-count").textContent = cart.length;
}

function renderCartModal() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const list = document.getElementById("cart-list");
    list.innerHTML = "";

    cart.forEach((book, index) => {
        const li = document.createElement("li");
        li.className = "border p-2 rounded flex flex-col space-y-2";
        li.innerHTML = `
             <div class="flex space-x-3">
                <img src="${book.image}" alt="${book.name}" class="w-20 h-28 object-cover rounded-lg">
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h2 class="font-bold text-gray-800 text-sm">${book.name}</h2>
                        <p class="text-gray-500 text-xs">${book.author || ''}</p>
                    </div>
                    <div class="price">
  <span class="text-gray-400 line-through mr-2">${book.list_price}</span>
  <span class="text-red-500 font-bold">${book.price}‚Çº</span>
</div>
                    <div class="mt-2 flex items-center justify-between">
                        <a href="viewdetail.html?product=${book.product_url}" target="_blank" class="text-blue-500 text-xs hover:underline">View Details</a>
                        <button class="remove-btn text-red-500 text-xs px-2 py-1 rounded border border-red-500 hover:bg-red-500 hover:text-white transition">Sil</button>
                    </div>
                </div>
            </div>
        `;
        list.appendChild(li);

        li.querySelector(".remove-btn").addEventListener("click", () => {
            removeFromCart(index);
        });
    });

    // const countBottom = document.getElementById("cart-count-bottom");
    // if (countBottom) countBottom.textContent = cart.length;
}

function removeFromCart(index) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    renderCartModal();
}


// LIKE FUNKSƒ∞YALARI
function likeBook(book) {
    let liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    const urlsInLiked = liked.map(item => String(item.product_url));

    if (!urlsInLiked.includes(String(book.product_url))) {
        liked.push(book);
        localStorage.setItem("likedBooks", JSON.stringify(liked));
        updateLikeCount();
        renderLikeModal();
        showToast(`${book.name} b…ôy…ônildi!`, "success");
    } else {
        showToast("Bu kitab artƒ±q b…ôy…ônilib!", "error");
    }
}

function updateLikeCount() {
    const liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    document.getElementById("like-count").textContent = liked.length;
}

function renderLikeModal() {
    const liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    const list = document.getElementById("like-list");
    list.innerHTML = "";

    liked.forEach((book, index) => {
        const li = document.createElement("li");
        li.className = "border p-2 rounded flex flex-col space-y-2";
        li.innerHTML = `
             <div class="flex space-x-3">
                <img src="${book.image}" alt="${book.name}" class="w-20 h-28 object-cover rounded-lg">
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h2 class="font-bold text-gray-800 text-sm">${book.name}</h2>
                        <p class="text-gray-500 text-xs">${book.author || ''}</p>
                        <a href="viewdetail.html?product=${book.product_url}" target="_blank" class="text-blue-500 text-xs hover:underline">View Details</a>
                    </div>
                    <div class="price">
  <span class="text-gray-400 line-through mr-2">${book.list_price}</span>
  <span class="text-red-500 font-bold">${book.price}‚Çº</span>
</div>
                    <div class="mt-2 flex items-center justify-between">
                         <button class="add-to-cart-btn bg-green-500 text-white px-3 py-1 rounded text-xs">S…ôb…ôt…ô …ôlav…ô et</button>
                        <button class="remove-btn text-red-500 text-xs px-2 py-1 rounded border border-red-500 hover:bg-red-500 hover:text-white transition">Sil</button>
                    </div>
                </div>
            </div>
        `;
        list.appendChild(li);
        li.querySelector(".add-to-cart-btn").addEventListener("click", () => {
            addToCart(book);
        });

        li.querySelector(".remove-btn").addEventListener("click", () => {
            removeFromLiked(index);
        });
    });

    const countBottom = document.getElementById("like-count-bottom");
    if (countBottom) countBottom.textContent = liked.length;
}

function removeFromLiked(index) {
    let liked = JSON.parse(localStorage.getItem("likedBooks")) || [];
    liked.splice(index, 1);
    localStorage.setItem("likedBooks", JSON.stringify(liked));
    updateLikeCount();
    renderLikeModal();
}


// Modern Toast
function showToast(message, type = "success") {
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg text-white z-50 ${
        type === "success" ? "bg-green-500" : "bg-red-500"
    }`;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.remove();
    }, 2000);
}
document.getElementById("cart-wrapper").addEventListener("click", () => {
    renderCartModal();
    document.getElementById("cart-modal").classList.remove("translate-x-full");
});

document.getElementById("").addEventListener("click", () => {
    document.getElementById("cart-modal").classList.add("translate-x-full");
});

// 5Ô∏è‚É£ Sayt a√ßƒ±lan kimi cart sayƒ± g√∂st…ôrilsin
updateCartCount(); 

  </script>
  <script type="module" src="../js/headerCatalog.js"></script>
    <script type="module" src="../js/authors.js"></script>
    <script type="module" src="../js/data.js"></script>
    <script src="../js/showpopup.js"></script>
   
    <script type="module" src="../js/search.js"></script>
    <script type="module" src="../js/kategory.js"></script>
    <script type="module" src="../js/slider.js"></script>
    <script type="module" src="../js/script.js"></script>
    <script src="./middleware/headerProvider.js"></script>
    <script src="./middle/middleware.js"></script>
    <script type="module src="../js/service.js"></script>
    <script type="module" src="../js/index.js"></script>
</body>
</html>
